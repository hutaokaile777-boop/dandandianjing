<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿å¤§è½¬ç›˜</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #222; color: #fff; }
        .wheel-container { position: relative; width: 300px; height: 300px; margin-bottom: 30px; }
        .wheel { width: 100%; height: 100%; border-radius: 50%; border: 8px solid #fff; box-shadow: 0 0 20px rgba(0,0,0,0.5); transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99); }
        .pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #ff0055; z-index: 10; }
        button { padding: 12px 30px; font-size: 18px; border: none; border-radius: 50px; background: linear-gradient(45deg, #ff0055, #ff5500); color: white; cursor: pointer; }
        button:disabled { background: #555; }
        #result { margin-top: 20px; text-align: center; min-height: 80px; }
        .code-box { display: block; margin-top: 10px; padding: 10px; background: #333; border: 1px dashed #4ade80; color: #4ade80; }
    </style>
</head>
<body>
    <h1>âœ¨ å¹¸è¿æŠ½å¥– âœ¨</h1>
    <div class="wheel-container">
        <div class="pointer"></div>
        <div class="wheel" id="wheel"></div>
    </div>
    <button id="spinBtn" onclick="spin()">ç‚¹å‡»æŠ½å¥–</button>
    <div id="result"></div>

    <script>
        // å¥–å“é…ç½®éœ€ä¸åç«¯ä¸€è‡´ï¼Œä»…ç”¨äºå‰ç«¯è½¬ç›˜æ¸²æŸ“
        const PRIZES = [
            { name: "è°¢è°¢å‚ä¸", color: "#f5f5f5" },
            { name: "10å…ƒä»£é‡‘åˆ¸", color: "#ffe066" },
            { name: "VIP 7å¤©å¡", color: "#e3fafc" },
            { name: "iPhone 15", color: "#ff8787" }
        ];

        const wheel = document.getElementById('wheel');
        const resultDiv = document.getElementById('result');
        const spinBtn = document.getElementById('spinBtn');
        let currentRotation = 0;

        // åˆå§‹åŒ–è½¬ç›˜é¢œè‰²
        const segment = 360 / PRIZES.length;
        wheel.style.background = `conic-gradient(${PRIZES.map((p, i) => `${p.color} ${i*segment}deg ${(i+1)*segment}deg`).join(', ')})`;

        async function spin() {
            spinBtn.disabled = true;
            resultDiv.innerText = "æ­£åœ¨è·å–ç»“æœ...";

            try {
                // è¯·æ±‚ Vercel ä¸­è½¬çš„åç«¯æ¥å£
                const response = await fetch('/api/draw', { method: 'POST' });
                const data = await response.json();

                if (!data.success) {
                    resultDiv.innerHTML = `<b style="color:#ffae00">${data.message}</b><br>ç»“æœ: ${data.oldPrize || ''} ${data.oldCode ? '<span class="code-box">'+data.oldCode+'</span>' : ''}`;
                    return;
                }

                const targetAngle = -(data.prizeIndex * segment + segment / 2);
                currentRotation += (360 * 5) + targetAngle - (currentRotation % 360);
                wheel.style.transform = `rotate(${currentRotation}deg)`;

                setTimeout(() => {
                    resultDiv.innerHTML = `ğŸ‰ æ­å–œä¸­å¥–: <strong>${data.prizeName}</strong> ${data.code ? '<span class="code-box">'+data.code+'</span>' : ''}`;
                }, 4000);
            } catch (e) {
                resultDiv.innerText = "ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•";
                spinBtn.disabled = false;
            }
        }
    </script>
</body>
</html>